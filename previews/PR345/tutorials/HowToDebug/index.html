<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Print debug output ¬∑ Manopt.jl</title><meta name="title" content="Print debug output ¬∑ Manopt.jl"/><meta property="og:title" content="Print debug output ¬∑ Manopt.jl"/><meta property="twitter:title" content="Print debug output ¬∑ Manopt.jl"/><meta name="description" content="Documentation for Manopt.jl."/><meta property="og:description" content="Documentation for Manopt.jl."/><meta property="twitter:description" content="Documentation for Manopt.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Manopt.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Manopt.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../about/">About</a></li><li><span class="tocitem">How to...</span><ul><li><a class="tocitem" href="../Optimize/">üèîÔ∏è Get started: optimize.</a></li><li><a class="tocitem" href="../InplaceGradient/">Speedup using in-place computations</a></li><li><a class="tocitem" href="../AutomaticDifferentiation/">Use automatic differentiation</a></li><li><a class="tocitem" href="../EmbeddingObjectives/">Define objectives in the embedding</a></li><li><a class="tocitem" href="../CountAndCache/">Count and use a cache</a></li><li class="is-active"><a class="tocitem" href>Print debug output</a><ul class="internal"><li><a class="tocitem" href="#Simple-debug-output"><span>Simple debug output</span></a></li><li><a class="tocitem" href="#Advanced-debug-output"><span>Advanced debug output</span></a></li><li><a class="tocitem" href="#Subsolver-debug"><span>Subsolver debug</span></a></li></ul></li><li><a class="tocitem" href="../HowToRecord/">Record values</a></li><li><a class="tocitem" href="../ImplementASolver/">Implement a solver</a></li><li><a class="tocitem" href="../ImplementOwnManifold/">Optimize on your own manifold</a></li><li><a class="tocitem" href="../ConstrainedOptimization/">Do constrained optimization</a></li><li><a class="tocitem" href="../GeodesicRegression/">Do geodesic regression</a></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../../solvers/">Introduction</a></li><li><a class="tocitem" href="../../solvers/adaptive-regularization-with-cubics/">Adaptive Regularization with Cubics</a></li><li><a class="tocitem" href="../../solvers/alternating_gradient_descent/">Alternating Gradient Descent</a></li><li><a class="tocitem" href="../../solvers/augmented_Lagrangian_method/">Augmented Lagrangian Method</a></li><li><a class="tocitem" href="../../solvers/ChambollePock/">Chambolle-Pock</a></li><li><a class="tocitem" href="../../solvers/conjugate_gradient_descent/">Conjugate gradient descent</a></li><li><a class="tocitem" href="../../solvers/cyclic_proximal_point/">Cyclic Proximal Point</a></li><li><a class="tocitem" href="../../solvers/difference_of_convex/">Difference of Convex</a></li><li><a class="tocitem" href="../../solvers/DouglasRachford/">Douglas‚ÄîRachford</a></li><li><a class="tocitem" href="../../solvers/exact_penalty_method/">Exact Penalty Method</a></li><li><a class="tocitem" href="../../solvers/FrankWolfe/">Frank-Wolfe</a></li><li><a class="tocitem" href="../../solvers/gradient_descent/">Gradient Descent</a></li><li><a class="tocitem" href="../../solvers/LevenbergMarquardt/">Levenberg‚ÄìMarquardt</a></li><li><a class="tocitem" href="../../solvers/NelderMead/">Nelder‚ÄìMead</a></li><li><a class="tocitem" href="../../solvers/particle_swarm/">Particle Swarm Optimization</a></li><li><a class="tocitem" href="../../solvers/primal_dual_semismooth_Newton/">Primal-dual Riemannian semismooth Newton</a></li><li><a class="tocitem" href="../../solvers/quasi_Newton/">Quasi-Newton</a></li><li><a class="tocitem" href="../../solvers/stochastic_gradient_descent/">Stochastic Gradient Descent</a></li><li><a class="tocitem" href="../../solvers/subgradient/">Subgradient method</a></li><li><a class="tocitem" href="../../solvers/truncated_conjugate_gradient_descent/">Steihaug-Toint TCG Method</a></li><li><a class="tocitem" href="../../solvers/trust_regions/">Trust-Regions Solver</a></li></ul></li><li><span class="tocitem">Plans</span><ul><li><a class="tocitem" href="../../plans/">Specify a Solver</a></li><li><a class="tocitem" href="../../plans/problem/">Problem</a></li><li><a class="tocitem" href="../../plans/objective/">Objective</a></li><li><a class="tocitem" href="../../plans/state/">Solver State</a></li><li><a class="tocitem" href="../../plans/stepsize/">Stepsize</a></li><li><a class="tocitem" href="../../plans/stopping_criteria/">Stopping Criteria</a></li><li><a class="tocitem" href="../../plans/debug/">Debug Output</a></li><li><a class="tocitem" href="../../plans/record/">Recording values</a></li></ul></li><li><span class="tocitem">Helpers</span><ul><li><a class="tocitem" href="../../helpers/checks/">Checks</a></li><li><a class="tocitem" href="../../helpers/exports/">Exports</a></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributing to Manopt.jl</a></li><li><a class="tocitem" href="../../extensions/">Extensions</a></li><li><a class="tocitem" href="../../notation/">Notation</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to...</a></li><li class="is-active"><a href>Print debug output</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Print debug output</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaManifolds/Manopt.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaManifolds/Manopt.jl/blob/master/docs/src/tutorials/HowToDebug.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-print-debug-output"><a class="docs-heading-anchor" href="#How-to-print-debug-output">How to print debug output</a><a id="How-to-print-debug-output-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-print-debug-output" title="Permalink"></a></h1><p>Ronny Bergmann</p><p>This tutorial aims to illustrate how to perform debug output. For that we consider an example that includes a subsolver, to also consider their debug capabilities.</p><p>The problem itself is hence not the main focus.</p><p>We consider a nonnegative PCA which we can write as a constraint problem on the Sphere</p><p>Let‚Äôs first load the necessary packages.</p><pre><code class="language-julia hljs">using Manopt, Manifolds, Random, LinearAlgebra
Random.seed!(42);</code></pre><pre><code class="language-julia hljs">d = 4
M = Sphere(d - 1)
v0 = project(M, [ones(2)..., zeros(d - 2)...])
Z = v0 * v0&#39;
#Cost and gradient
f(M, p) = -tr(transpose(p) * Z * p) / 2
grad_f(M, p) = project(M, p, -transpose.(Z) * p / 2 - Z * p / 2)
# Constraints
g(M, p) = -p # i.e. p ‚â• 0
mI = -Matrix{Float64}(I, d, d)
# Vector of gradients of the constraint components
grad_g(M, p) = [project(M, p, mI[:, i]) for i in 1:d]</code></pre><p>Then we can take a starting point</p><pre><code class="language-julia hljs">p0 = project(M, [ones(2)..., zeros(d - 3)..., 0.1])</code></pre><h2 id="Simple-debug-output"><a class="docs-heading-anchor" href="#Simple-debug-output">Simple debug output</a><a id="Simple-debug-output-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-debug-output" title="Permalink"></a></h2><p>Any solver accepts the keyword <code>debug=</code>, which in the simplest case can be set to an array of strings, symbols and a number.</p><ul><li>Strings are printed in every iteration as is (cf.¬†<a href="../../plans/debug/#Manopt.DebugDivider"><code>DebugDivider</code></a>) and should be used to finish the array with a line break.</li><li>the last number in the array is used with <a href="../../plans/debug/#Manopt.DebugEvery"><code>DebugEvery</code></a> to print the debug only every <span>$i$</span>th iteration.</li><li>Any Symbol is converted into certain debug prints</li></ul><p>Certain symbols starting with a capital letter are mapped to certain prints, for example <code>:Cost</code> is mapped to <a href="../../plans/debug/#Manopt.DebugCost"><code>DebugCost</code></a><code>()</code> to print the current cost function value. A full list is provided in the <a href="../../plans/debug/#Manopt.DebugActionFactory-Tuple{String}"><code>DebugActionFactory</code></a>. A special keyword is <code>:Stop</code>, which is only added to the final debug hook to print the stopping criterion.</p><p>Any symbol with a small letter is mapped to fields of the <a href="../../plans/state/#Manopt.AbstractManoptSolverState"><code>AbstractManoptSolverState</code></a> which is used. This way you can easily print internal data, if you know their names.</p><p>Let‚Äôs look at an example first: If we want to print the current iteration number, the current cost function value as well as the value <code>œµ</code> from the <a href="../../solvers/exact_penalty_method/#Manopt.ExactPenaltyMethodState"><code>ExactPenaltyMethodState</code></a>. To keep the amount of print at a reasonable level, we want to only print the debug every twentyfifth iteration.</p><p>Then we can write</p><pre><code class="language-julia hljs">p1 = exact_penalty_method(
    M, f, grad_f, p0; g=g, grad_g=grad_g,
    debug = [:Iteration, :Cost, &quot; | &quot;, :œµ, 25, &quot;\n&quot;, :Stop]
);</code></pre><pre><code class="nohighlight hljs">Initial f(x): -0.497512 | œµ: 0.001
# 25    f(x): -0.499449 | œµ: 0.0001778279410038921
# 50    f(x): -0.499995 | œµ: 3.1622776601683734e-5
# 75    f(x): -0.500000 | œµ: 5.623413251903474e-6
# 100   f(x): -0.500000 | œµ: 1.0e-6
The value of the variable (œµ) is smaller than or equal to its threshold (1.0e-6).
The algorithm performed a step with a change (6.534762378321919e-9) less than 1.0e-6.</code></pre><h2 id="Advanced-debug-output"><a class="docs-heading-anchor" href="#Advanced-debug-output">Advanced debug output</a><a id="Advanced-debug-output-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-debug-output" title="Permalink"></a></h2><p>There is two more advanced variants that can be used. The first is a tuple of a symbol and a string, where the string is used as the format print, that most <a href="../../plans/debug/#Manopt.DebugAction"><code>DebugAction</code></a>s have. The second is, to directly provide a <code>DebugAction</code>.</p><p>We can for example change the way the <code>:œµ</code> is printed by adding a format string and use <a href="../../plans/debug/#Manopt.DebugCost"><code>DebugCost</code></a><code>()</code> which is equivalent to using <code>:Cost</code>. Especially with the format change, the lines are more consistent in length.</p><pre><code class="language-julia hljs">p2 = exact_penalty_method(
    M, f, grad_f, p0; g=g, grad_g=grad_g,
    debug = [:Iteration, DebugCost(), (:œµ,&quot; | œµ: %.8f&quot;), 25, &quot;\n&quot;, :Stop]
);</code></pre><pre><code class="nohighlight hljs">Initial f(x): -0.497512 | œµ: 0.00100000
# 25    f(x): -0.499449 | œµ: 0.00017783
# 50    f(x): -0.499995 | œµ: 0.00003162
# 75    f(x): -0.500000 | œµ: 0.00000562
# 100   f(x): -0.500000 | œµ: 0.00000100
The value of the variable (œµ) is smaller than or equal to its threshold (1.0e-6).
The algorithm performed a step with a change (6.534762378321919e-9) less than 1.0e-6.</code></pre><p>You can also write your own <a href="../../plans/debug/#Manopt.DebugAction"><code>DebugAction</code></a> functor, where the function to implement has the same signature as the <code>step</code> function, that is an <a href="../../plans/problem/#Manopt.AbstractManoptProblem"><code>AbstractManoptProblem</code></a>, an <a href="../../plans/state/#Manopt.AbstractManoptSolverState"><code>AbstractManoptSolverState</code></a>, as well as the current iterate. For example the already mentioned<a href="../../plans/debug/#Manopt.DebugDivider"><code>DebugDivider</code></a><code>(s)</code> is given as</p><pre><code class="language-julia hljs">mutable struct DebugDivider{TIO&lt;:IO} &lt;: DebugAction
    io::TIO
    divider::String
    DebugDivider(divider=&quot; | &quot;; io::IO=stdout) = new{typeof(io)}(io, divider)
end
function (d::DebugDivider)(::AbstractManoptProblem, ::AbstractManoptSolverState, i::Int)
    (i &gt;= 0) &amp;&amp; (!isempty(d.divider)) &amp;&amp; (print(d.io, d.divider))
    return nothing
end</code></pre><p>or you could implement that of course just for your specific problem or state.</p><h2 id="Subsolver-debug"><a class="docs-heading-anchor" href="#Subsolver-debug">Subsolver debug</a><a id="Subsolver-debug-1"></a><a class="docs-heading-anchor-permalink" href="#Subsolver-debug" title="Permalink"></a></h2><p>most subsolvers have a <code>sub_kwargs</code> keyword, such that you can pass keywords to the sub solver as well. This works well if you do not plan to change the subsolver. If you do you can wrap your own <code>solver_state=</code> argument in a <a href="../../plans/state/#Manopt.decorate_state!"><code>decorate_state!</code></a> and pass a <code>debug=</code> password to this function call. Keywords in a keyword have to be passed as pairs (<code>:debug =&gt; [...]</code>).</p><p>A main problem now is, that this debug is issued every sub solver call or initialisation, as the following print of just a <code>.</code> per sub solver test/call illustrates</p><pre><code class="language-julia hljs">p3 = exact_penalty_method(
    M, f, grad_f, p0; g=g, grad_g=grad_g,
    debug = [&quot;\n&quot;,:Iteration, DebugCost(), (:œµ,&quot; | œµ: %.8f&quot;), 25, &quot;\n&quot;, :Stop],
    sub_kwargs = [:debug =&gt; [&quot;.&quot;]]
);</code></pre><pre><code class="nohighlight hljs">Initial f(x): -0.497512 | œµ: 0.00100000
........................................................
# 25    f(x): -0.499449 | œµ: 0.00017783
..................................................
# 50    f(x): -0.499995 | œµ: 0.00003162
..................................................
# 75    f(x): -0.500000 | œµ: 0.00000562
..................................................
# 100   f(x): -0.500000 | œµ: 0.00000100
....The value of the variable (œµ) is smaller than or equal to its threshold (1.0e-6).
The algorithm performed a step with a change (6.534762378321919e-9) less than 1.0e-6.</code></pre><p>The different lengths of the dotted lines come from the fact that ‚Äîat least in the beginning‚Äî the subsolver performs a few steps.</p><p>For this issue, there is the next symbol (similar to the <code>:Stop</code>) to indicate that a debug set is a subsolver set <code>:Subsolver</code>, which introduces a <a href="../../plans/debug/#Manopt.DebugWhenActive"><code>DebugWhenActive</code></a> that is only activated when the outer debug is actually active, i.e.¬†<a href="../../plans/debug/#Manopt.DebugEvery"><code>DebugEvery</code></a> is active itself. Let‚Äôs</p><pre><code class="language-julia hljs">p4 = exact_penalty_method(
  M, f, grad_f, p0; g=g, grad_g=grad_g,
  debug = [:Iteration, DebugCost(), (:œµ,&quot; | œµ: %.8f&quot;), 25, &quot;\n&quot;, :Stop],
  sub_kwargs = [
    :debug =&gt; [&quot; | &quot;, :Iteration, :Cost, &quot;\n&quot;,:Stop, :Subsolver]
  ]
);</code></pre><pre><code class="nohighlight hljs">Initial f(x): -0.497512 | œµ: 0.00100000
 | Initial f(x): -0.499127
 | # 1     f(x): -0.499147
The algorithm reached approximately critical point after 1 iterations; the gradient norm (0.0002121889852717436) is less than 0.001.
# 25    f(x): -0.499449 | œµ: 0.00017783
 | Initial f(x): -0.499993
 | # 1     f(x): -0.499994
The algorithm reached approximately critical point after 1 iterations; the gradient norm (1.6025009584517956e-5) is less than 0.001.
# 50    f(x): -0.499995 | œµ: 0.00003162
 | Initial f(x): -0.500000
 | # 1     f(x): -0.500000
The algorithm reached approximately critical point after 1 iterations; the gradient norm (9.966301158129447e-7) is less than 0.001.
# 75    f(x): -0.500000 | œµ: 0.00000562
 | Initial f(x): -0.500000
 | # 1     f(x): -0.500000
The algorithm reached approximately critical point after 1 iterations; the gradient norm (5.4875346930698466e-8) is less than 0.001.
# 100   f(x): -0.500000 | œµ: 0.00000100
The value of the variable (œµ) is smaller than or equal to its threshold (1.0e-6).
The algorithm performed a step with a change (6.534762378321919e-9) less than 1.0e-6.</code></pre><p>where we now see that the subsolver always only requires one step. Note that since debug of an iteration is happening <em>after</em> a step, we see the sub solver run <em>before</em> the debug for an iteration number.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../CountAndCache/">¬´ Count and use a cache</a><a class="docs-footer-nextpage" href="../HowToRecord/">Record values ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Thursday 18 January 2024 17:36">Thursday 18 January 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

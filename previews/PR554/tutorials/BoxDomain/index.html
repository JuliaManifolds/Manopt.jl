<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Do optimization with bounds ¬∑ Manopt.jl</title><meta name="title" content="Do optimization with bounds ¬∑ Manopt.jl"/><meta property="og:title" content="Do optimization with bounds ¬∑ Manopt.jl"/><meta property="twitter:title" content="Do optimization with bounds ¬∑ Manopt.jl"/><meta name="description" content="Documentation for Manopt.jl."/><meta property="og:description" content="Documentation for Manopt.jl."/><meta property="twitter:description" content="Documentation for Manopt.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/link-icons.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Manopt.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Manopt.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../about/">About</a></li><li><span class="tocitem">How to...</span><ul><li><a class="tocitem" href="../getstarted/">üèîÔ∏è Get started with Manopt.jl</a></li><li><a class="tocitem" href="../InplaceGradient/">Speedup using in-place computations</a></li><li><a class="tocitem" href="../AutomaticDifferentiation/">Use automatic differentiation</a></li><li><a class="tocitem" href="../EmbeddingObjectives/">Define objectives in the embedding</a></li><li><a class="tocitem" href="../CountAndCache/">Count and use a cache</a></li><li><a class="tocitem" href="../HowToDebug/">Print debug output</a></li><li><a class="tocitem" href="../HowToRecord/">Record values</a></li><li><a class="tocitem" href="../ImplementASolver/">Implement a solver</a></li><li><a class="tocitem" href="../ImplementOwnManifold/">Optimize on your own manifold</a></li><li><a class="tocitem" href="../ConstrainedOptimization/">Do constrained optimization</a></li><li class="is-active"><a class="tocitem" href>Do optimization with bounds</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Optimization-with-box-domains-and-products-of-manifolds-and-boxes"><span>Optimization with box domains and products of manifolds and boxes</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li></ul></li><li><span class="tocitem">Solvers</span><ul><li><a class="tocitem" href="../../solvers/">List of Solvers</a></li><li><a class="tocitem" href="../../solvers/adaptive-regularization-with-cubics/">Adaptive Regularization with Cubics</a></li><li><a class="tocitem" href="../../solvers/alternating_gradient_descent/">Alternating Gradient Descent</a></li><li><a class="tocitem" href="../../solvers/augmented_Lagrangian_method/">Augmented Lagrangian Method</a></li><li><a class="tocitem" href="../../solvers/ChambollePock/">Chambolle-Pock</a></li><li><a class="tocitem" href="../../solvers/cma_es/">CMA-ES</a></li><li><a class="tocitem" href="../../solvers/conjugate_gradient_descent/">Conjugate gradient descent</a></li><li><a class="tocitem" href="../../solvers/conjugate_residual/">Conjugate Residual</a></li><li><a class="tocitem" href="../../solvers/convex_bundle_method/">Convex bundle method</a></li><li><a class="tocitem" href="../../solvers/cyclic_proximal_point/">Cyclic Proximal Point</a></li><li><a class="tocitem" href="../../solvers/difference_of_convex/">Difference of Convex</a></li><li><a class="tocitem" href="../../solvers/DouglasRachford/">Douglas‚ÄîRachford</a></li><li><a class="tocitem" href="../../solvers/exact_penalty_method/">Exact Penalty Method</a></li><li><a class="tocitem" href="../../solvers/FrankWolfe/">Frank-Wolfe</a></li><li><a class="tocitem" href="../../solvers/generalized_cauchy_direction_subsolver/">Generalized Cauchy direction subsolver</a></li><li><a class="tocitem" href="../../solvers/gradient_descent/">Gradient Descent</a></li><li><a class="tocitem" href="../../solvers/interior_point_Newton/">Interior Point Newton</a></li><li><a class="tocitem" href="../../solvers/LevenbergMarquardt/">Levenberg‚ÄìMarquardt</a></li><li><a class="tocitem" href="../../solvers/mesh_adaptive_direct_search/">Mesh Adaptive Direct Search</a></li><li><a class="tocitem" href="../../solvers/NelderMead/">Nelder‚ÄìMead</a></li><li><a class="tocitem" href="../../solvers/particle_swarm/">Particle Swarm Optimization</a></li><li><a class="tocitem" href="../../solvers/primal_dual_semismooth_Newton/">Primal-dual Riemannian semismooth Newton</a></li><li><a class="tocitem" href="../../solvers/projected_gradient_method/">Projected Gradient Method</a></li><li><a class="tocitem" href="../../solvers/proximal_bundle_method/">Proximal bundle method</a></li><li><a class="tocitem" href="../../solvers/proximal_gradient_method/">Proximal Gradient Method</a></li><li><a class="tocitem" href="../../solvers/quasi_Newton/">Quasi-Newton</a></li><li><a class="tocitem" href="../../solvers/stochastic_gradient_descent/">Stochastic Gradient Descent</a></li><li><a class="tocitem" href="../../solvers/subgradient/">Subgradient method</a></li><li><a class="tocitem" href="../../solvers/truncated_conjugate_gradient_descent/">Steihaug-Toint TCG Method</a></li><li><a class="tocitem" href="../../solvers/trust_regions/">Trust-Regions Solver</a></li><li><a class="tocitem" href="../../solvers/vectorbundle_newton/">Vector Bundle Newton Method</a></li></ul></li><li><span class="tocitem">Plans</span><ul><li><a class="tocitem" href="../../plans/">Specify a Solver</a></li><li><a class="tocitem" href="../../plans/problem/">Problem</a></li><li><a class="tocitem" href="../../plans/objective/">Objective</a></li><li><a class="tocitem" href="../../plans/state/">Solver State</a></li><li><a class="tocitem" href="../../plans/stepsize/">Stepsize</a></li><li><a class="tocitem" href="../../plans/stopping_criteria/">Stopping Criteria</a></li><li><a class="tocitem" href="../../plans/debug/">Debug Output</a></li><li><a class="tocitem" href="../../plans/record/">Recording values</a></li></ul></li><li><span class="tocitem">Helpers</span><ul><li><a class="tocitem" href="../../helpers/checks/">Checks</a></li><li><a class="tocitem" href="../../helpers/exports/">Exports</a></li><li><a class="tocitem" href="../../helpers/test/">Test</a></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributing to Manopt.jl</a></li><li><a class="tocitem" href="../../extensions/">Extensions</a></li><li><a class="tocitem" href="../../notation/">Notation</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to...</a></li><li class="is-active"><a href>Do optimization with bounds</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Do optimization with bounds</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaManifolds/Manopt.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaManifolds/Manopt.jl/blob/master/docs/src/tutorials/BoxDomain.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-do-optimization-on-box-domains"><a class="docs-heading-anchor" href="#How-to-do-optimization-on-box-domains">How to do optimization on box domains</a><a id="How-to-do-optimization-on-box-domains-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-do-optimization-on-box-domains" title="Permalink"></a></h1><p>Mateusz Baran</p><h1 id="Optimization-with-box-domains-and-products-of-manifolds-and-boxes"><a class="docs-heading-anchor" href="#Optimization-with-box-domains-and-products-of-manifolds-and-boxes">Optimization with box domains and products of manifolds and boxes</a><a id="Optimization-with-box-domains-and-products-of-manifolds-and-boxes-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization-with-box-domains-and-products-of-manifolds-and-boxes" title="Permalink"></a></h1><p>A <a href="https://juliamanifolds.github.io/Manifolds.jl/stable/manifolds/hyperrectangle/#Manifolds.Hyperrectangle"><code>Hyperrectangle</code></a> is, in general, not a manifold but a manifold with corners because locally at the boundary it looks like <span>$\mathbb{R}^{n-k} \times \mathbb{R}^k_{\geq 0}$</span> for some <span>$k &gt; 0$</span>, instead of <span>$\mathbb{R}^n$</span> as required by the definition of a manifold.</p><p>Such spaces require special handling when used as domains in optimization. For simple methods like gradient descent using projected gradient and a stopping criterion involving <a href="../../plans/stopping_criteria/#Manopt.StopWhenProjectedNegativeGradientNormLess"><code>StopWhenProjectedNegativeGradientNormLess</code></a> may be sufficient, however methods that approximate the Hessian can benefit from a more advanced approach. The core idea is considering a piecewise quadratic approximation of the objective along the descent direction in the tangent space at the current iterate, and selecting the generalized Cauchy direction ‚Äì its minimizer. The points at which the approximation might not be differentiable correspond to hitting new boundaries along the initially selected descent direction. Then, we can perform standard line search from the initial iterate in the generalized Cauchy direction.</p><p>Currently <code>Manopt.jl</code> can handle domains that are either a <a href="https://juliamanifolds.github.io/Manifolds.jl/stable/manifolds/hyperrectangle/#Manifolds.Hyperrectangle"><code>Hyperrectangle</code></a> or a <a href="https://juliamanifolds.github.io/ManifoldsBase.jl/stable/metamanifolds/#ManifoldsBase.ProductManifold"><code>ProductManifold</code></a> containing a <a href="https://juliamanifolds.github.io/Manifolds.jl/stable/manifolds/hyperrectangle/#Manifolds.Hyperrectangle"><code>Hyperrectangle</code></a> as its first factor and other manifolds as subsequent factors.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Consider the problem of fitting covariance matrix with box constraints on variance in principal directions. The objective is log-probability of data under a multivariate normal distribution with zero mean and covariance matrix given by the variable to optimize. Although there are better ways to solve this problem, expressing it this way allows us to freely extend the objective to more complex scenarios beyond what is possible with closed-form solutions.</p><p>First, we set up the problem by generating synthetic data. The data is sampled from a multivariate normal distribution with known covariance matrix.</p><pre><code class="language-julia hljs">using Manopt, Manifolds, LinearAlgebra, Random, Distributions
using ForwardDiff, DifferentiationInterface, RecursiveArrayTools
Random.seed!(41)

N = 5 # dimensionality of data
M_spd = SymmetricPositiveDefinite(N)
M_rot = Rotations(N)
V = rand(M_rot)
cov_matrix = Symmetric(V * Diagonal([0.5; 2.0; 5.0; 10.0; 20.0]) * V&#39;)
distr = MvNormal(zeros(N), cov_matrix)
data = Matrix(rand(distr, 200)&#39;)  # 200 samples</code></pre><pre><code class="nohighlight hljs">200√ó5 Matrix{Float64}:
 -1.71519     7.90097     4.28701    -3.91166    -3.52822
 -6.21275    -7.19569     0.237793   -0.0950468  -2.14304
 -5.14083    -3.87093     0.0175424   0.519236   -1.69341
 -0.798949    3.30071     1.79817     0.45475    -1.413
 -3.99451    -4.82816     0.12508     0.875412   -0.185293
  0.789528   -0.291098    1.64547     1.79327     2.21059
 -2.78019     3.11309    -0.744708   -1.26952    -0.803289
 -1.23441   -10.4689      0.0889228   4.49377     1.66938
 -3.39835     2.37467    -4.88986    -1.13343    -0.630297
  2.82479     5.33666    -3.10837     0.293323    2.00837
  ‚ãÆ                                              
  1.44015    -1.21025    -2.8555      0.0928556  -0.267104
  0.018282    4.6514      3.53344    -0.77436     0.551689
 -3.62832    -9.36256     3.06575     1.7817     -0.842772
 -3.61414    -3.33447    -2.34463    -0.0186825  -0.214014
 -0.651025   -2.31167     1.12179    -0.411333   -0.05979
  3.23986     1.85521    -1.09497     2.16809     0.915976
  2.4391     -1.01357    -0.894058    0.306356    0.461368
 -2.5047     -8.02181     1.46        0.143221   -0.790536
 -1.1727      0.0601283  -4.88644    -0.0923105  -1.28085</code></pre><p>The objective function is defined as follows, with gradient calculated using automatic differentiation.</p><pre><code class="language-julia hljs">function logprob_cost(::AbstractManifold, p)
    D, R = p.x
    logdet = sum(log, D)
    invŒ£ = R * Diagonal(1 ./ D) * R&#39;
    ll = - 0.5 * size(data, 1) * logdet
    for row in eachrow(data)
        ll -= 0.5 * row&#39; * invŒ£ * row
    end
    return -ll  # We minimize negative log-likelihood
end

function logprob_gradient(M::AbstractManifold, p)
    Y = DifferentiationInterface.gradient(q -&gt; logprob_cost(M, q), AutoForwardDiff(), p)
    return riemannian_gradient(M, p, Y)
end</code></pre><pre><code class="nohighlight hljs">logprob_gradient (generic function with 1 method)</code></pre><p>Finally, we can solve the optimization problem using a quasi-Newton method with box domain support. We restrict the variances (diagonal elements of the covariance matrix) to be between 1.0 and 100.0. The covariance matrix is represented using its eigendecomposition <span>$\Sigma = R D R^{\top}$</span>, where <span>$D$</span> is a diagonal matrix of variances and <span>$R$</span> is an orthogonal matrix of principal directions. With constraints on variances, the optimization variable belongs to <span>$[1,100]^N \times \mathrm{SO}(N)$</span>.</p><pre><code class="language-julia hljs">M = ProductManifold(Hyperrectangle(fill(1.0, N), fill(100.0, N)), M_rot)

p0 = ArrayPartition(fill(10.0, N), Matrix{Float64}(I(5)))
p_mle = quasi_Newton(M, logprob_cost, logprob_gradient, p0; stopping_criterion = StopAfterIteration(100) | StopWhenProjectedNegativeGradientNormLess(1e-6))
println(&quot;Estimated variances: $(p_mle.x[1])&quot;)
cov_matrix_mle = p_mle.x[2] * Diagonal(p_mle.x[1]) * p_mle.x[2]&#39;
println(&quot;Estimated covariance matrix:&quot;)
println(cov_matrix_mle)
nothing</code></pre><pre><code class="nohighlight hljs">Estimated variances: [9.337969965108982, 27.216611443303886, 4.9867071619249765, 1.0, 1.0]
Estimated covariance matrix:
[6.754759130663465 3.4630730187916807 ‚Ä¶ 0.9779829097452888 2.4475171379905736; 3.463073018791681 23.537854922048737 ‚Ä¶ -7.285757124055761 -3.7754157063540923; ‚Ä¶ ; 0.9779829097452888 -7.285757124055761 ‚Ä¶ 4.373435976829594 2.723615793861439; 2.4475171379905736 -3.775415706354092 ‚Ä¶ 2.723615793861439 3.856787099101233]</code></pre><p>We see that despite the original covariance matrix having variances ranging from 0.5 to 20.0, the estimated covariance matrix respects the box constraints of variances between 1.0 and 100.0.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ConstrainedOptimization/">¬´ Do constrained optimization</a><a class="docs-footer-nextpage" href="../../solvers/">List of Solvers ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 17 February 2026 11:04">Tuesday 17 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

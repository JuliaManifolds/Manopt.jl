<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Gradient of d_2 · Manopt.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../../index.html"><img class="logo" src="../../assets/logo.png" alt="Manopt.jl logo"/></a><h1>Manopt.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../about/">About</a></li><li><span class="toctext">Manifolds</span><ul><li><a class="toctext" href="../../manifolds/">Introduction</a></li><li><a class="toctext" href="../../manifolds/combined/">Combinations of Manifolds</a></li><li><a class="toctext" href="../../manifolds/circle/">The Circle <span>$\mathbb S^1$</span></a></li><li><a class="toctext" href="../../manifolds/euclidean/">The Euclidean Space <span>$\mathbb R^n$</span></a></li><li><a class="toctext" href="../../manifolds/grassmannian/">The Grassmannian Manifold <span>$\mathrm{Gr}(k,n)$</span></a></li><li><a class="toctext" href="../../manifolds/hyperbolic/">The Hyperbolic Space <span>$\mathbb H^n$</span></a></li><li><a class="toctext" href="../../manifolds/rotations/">The Special Orthogonal Group <span>$\mathrm{SO}(n)$</span></a></li><li><a class="toctext" href="../../manifolds/sphere/">The Sphere <span>$\mathbb S^n$</span></a></li><li><a class="toctext" href="../../manifolds/stiefel/">The Stiefel Manifold <span>$\mathrm{St}(k,n)$</span></a></li><li><a class="toctext" href="../../manifolds/symmetric/">The Symmetric Matrices <span>$\mathrm{Sym}(n)$</span></a></li><li><a class="toctext" href="../../manifolds/symmetricpositivedefinite/">The Symmetric Positive Definite Matrices <span>$\mathcal P(n)$</span></a></li></ul></li><li><a class="toctext" href="../../plans/">Plans</a></li><li><span class="toctext">Solvers</span><ul><li><a class="toctext" href="../../solvers/">Introduction</a></li><li><a class="toctext" href="../../solvers/cyclicProximalPoint/">Cyclic Proximal Point</a></li><li><a class="toctext" href="../../solvers/DouglasRachford/">Douglas–Rachford</a></li><li><a class="toctext" href="../../solvers/gradientDescent/">Gradient Descent</a></li><li><a class="toctext" href="../../solvers/NelderMead/">Nelder–Mead</a></li><li><a class="toctext" href="../../solvers/subGradientMethod/">Subgradient Method</a></li><li><a class="toctext" href="../../solvers/truncatedConjugateGradient/">Steihaug-Toint TCG Method</a></li><li><a class="toctext" href="../../solvers/trustRegions/">Riemannian Trust-Regions Solver</a></li></ul></li><li><span class="toctext">Functions</span><ul><li><a class="toctext" href="../../functions/">Introduction</a></li><li><a class="toctext" href="../../functions/costFunctions/">cost functions</a></li><li><a class="toctext" href="../../functions/differentials/">Differentials</a></li><li><a class="toctext" href="../../functions/adjointDifferentials/">Adjoint Differentials</a></li><li><a class="toctext" href="../../functions/gradients/">Gradients</a></li><li><a class="toctext" href="../../functions/jacobiFields/">JacobiFields</a></li><li><a class="toctext" href="../../functions/proximalMaps/">Proximal Maps</a></li></ul></li><li><span class="toctext">Helpers</span><ul><li><a class="toctext" href="../../helpers/data/">Data</a></li><li><a class="toctext" href="../../helpers/errorMeasures/">Error Measures</a></li><li><a class="toctext" href="../../helpers/exports/">Exports</a></li></ul></li><li><span class="toctext">Tutorials</span><ul><li><a class="toctext" href="../MeanAndMedian/">Getting Started: Optimize!</a></li><li class="current"><a class="toctext" href>Gradient of <span>$d_2$</span></a><ul class="internal"><li><a class="toctext" href="#Literature-1">Literature</a></li></ul></li><li><a class="toctext" href="../JacobiFields/">Jacobi Fields</a></li></ul></li><li><a class="toctext" href="../../list/">Function Index</a></li></ul></nav><article id="docs"><header><nav><ul><li>Tutorials</li><li><a href>Gradient of <span>$d_2$</span></a></li></ul><a class="edit-page" href="https://github.com/kellertuer/Manopt.jl/blob/master/src/tutorials/GradientOfSecondOrderDifference.jl"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Gradient of d_2</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="secondOrderDifferenceGrad-1" href="#secondOrderDifferenceGrad-1">Illustration of the Gradient of a Second Order Difference</a></h1><p>This example explains how to compute the gradient of the second order difference mid point model using <a href="../../manifolds/#Manopt.adjointJacobiField"><code>adjointJacobiField</code></a>s.</p><p>This example also illustrates the <a href="../../manifolds/combined/#Manopt.Power"><code>Power</code></a> manifold as well as <a href="../../plans/#Manopt.ArmijoLinesearch"><code>ArmijoLinesearch</code></a>.</p><p>We first initialize the manifold</p><pre><code class="language-julia">using Manopt</code></pre><p>and we define some colors from <a href="https://personal.sron.nl/~pault/">Paul Tol</a></p><pre><code class="language-julia">using Colors
black = RGBA{Float64}(colorant&quot;#000000&quot;)
TolVibrantBlue = RGBA{Float64}(colorant&quot;#0077BB&quot;) # points
TolVibrantOrange = RGBA{Float64}(colorant&quot;#EE7733&quot;) # results
TolVibrantCyan = RGBA{Float64}(colorant&quot;#33BBEE&quot;) # vectors
TolVibrantTeal = RGBA{Float64}(colorant&quot;#009988&quot;) # geo
asyResolution = 2</code></pre><p>Assume we have two <a href="../../manifolds/sphere/#Manopt.SnPoint"><code>SnPoint</code></a>s <span>$x,y$</span> on the equator of the <a href="../../manifolds/sphere/#Manopt.Sphere"><code>Sphere</code></a><code>(2)</code> <span>$\mathcal M = \mathbb S^2$</span> and a point <span>$y$</span> near the north pole</p><pre><code class="language-julia">M = Sphere(2)
x = SnPoint([1., 0., 0.])
z = SnPoint([0., 1., 0.])
c = midPoint(M,x,z)
y = geodesic(M, SnPoint([0., 0., 1.]), c, 0.1)
[c,y]</code></pre><pre><code class="language-none">2-element Array{SnPoint{Float64},1}:
 Sn([0.7071067811865476, 0.7071067811865475, 0.0])                 
 Sn([0.11061587104123714, 0.11061587104123714, 0.9876883405951378])</code></pre><p>Now the second order absolute difference can be stated as (see [<a href="#BacakBergmannSteidlWeinmann2016">Bačák, Bergmann, Steidl, Weinmann, 2016</a>])</p><div>\[d_2(x,y,z) := \min_{c\in\mathcal C_{x,z}} d_{\mathcal M}(c,y),\qquad x,y,z\in\mathcal M,\]</div><p>where <span>$\mathcal C_{x,z}$</span> is the set of all mid points <span>$g(\frac{1}{2};x,z)$</span>, where <span>$g$</span> is a (not necessarily minimizing) geodesic connecting <span>$x$</span> and <span>$z$</span>.</p><p>For illustration we further define the point opposite of</p><pre><code class="language-julia">c2 = opposite(M,c)</code></pre><pre><code class="language-none">Sn([-0.7071067811865476, -0.7071067811865475, -0.0])</code></pre><p>and draw the geodesic connecting <span>$y$</span> and the nearest mid point <span>$c$</span>, namely</p><pre><code class="language-julia">T = [0:0.1:1.0...]
geoPts_yc = geodesic(M,y,c,T)</code></pre><p>looks as follows using <a href="../../helpers/exports/#Manopt.renderAsymptote"><code>renderAsymptote</code></a> with the <a href="../../helpers/exports/#Manopt.asyExportS2Signals"><code>asyExportS2Signals</code></a> export</p><pre><code class="language-julia">renderAsymptote(&quot;secondOrderData.asy&quot;,asyExportS2Signals;
    render = asyResolution,
    curves = [ geoPts_yc ],
    points = [ [x,y,z], [c,c2] ],
    colors=Dict(:curves =&gt; [TolVibrantTeal], :points =&gt; [black, TolVibrantBlue]),
    dotSize = 3.5, lineWidth = 0.75, cameraPosition = (1.2,1.,.5)
)</code></pre><p><img src="../../assets/images/tutorials/SecondOrderData.png" alt="Three points \$x,y,z\$ and the midpoint \$c=c(x,z)\$ (blue)"/></p><p>Since we moved <span>$y$</span> 10% along the geodesic from the north pole to <span>$c$</span>, the distance to <span>$c$</span> is <span>$\frac{9\pi}{20}\approx 1.4137$</span>, and this is also what</p><pre><code class="language-julia">costTV2(M, (x,y,z) )</code></pre><pre><code class="language-none">1.413716694115407</code></pre><p>returns, see <a href="../../functions/costFunctions/#Manopt.costTV2"><code>costTV2</code></a> for reference. But also its gradient can be easily computed since it is just a distance with respect to <span>$y$</span> and a concatenation of a geodesic, where the start or end point is the argument, respectively, with a distance. Hence the <a href="../../functions/adjointDifferentials/#adjointDifferentialFunctions-1">adjoint differentials</a> <a href="../../functions/adjointDifferentials/#Manopt.AdjDxGeo-Union{Tuple{T}, Tuple{P}, Tuple{mT}, Tuple{mT,P,P,Float64,T}} where T&lt;:TVector where P&lt;:MPoint where mT&lt;:Manifold"><code>AdjDxGeo</code></a> and <a href="../../functions/adjointDifferentials/#Manopt.AdjDyGeo-Union{Tuple{T}, Tuple{P}, Tuple{mT}, Tuple{mT,P,P,Float64,T}} where T&lt;:TVector where P&lt;:MPoint where mT&lt;:Manifold"><code>AdjDyGeo</code></a> can be employed, see <a href="../../functions/gradients/#Manopt.gradTV2"><code>gradTV2</code></a> for details. we obtain</p><pre><code class="language-julia">(ξx, ξy, ξz) = gradTV2(M, (x,y,z) )</code></pre><pre><code class="language-none">(SnT([-0.0, -4.967699558375196e-18, -0.7071067811865475]), SnT([-0.6984011233337104, -0.6984011233337103, 0.1564344650402309]), SnT([4.967699558375197e-18, 0.0, -0.7071067811865475]))</code></pre><p>When we aim to minimize this, we look at the negative gradient, i.e. we can draw this as</p><pre><code class="language-julia">renderAsymptote(&quot;SecondOrderGradient.asy&quot;,asyExportS2Signals;
   render = asyResolution,
   points = [ [x,y,z], [c,c2] ],
   tVectors = [TVectorE.( [-ξx, -ξy, -ξz], [x, y, z] )],
   colors=Dict(:tvectors =&gt; [TolVibrantCyan], :points =&gt; [black, TolVibrantBlue]),
   dotSize = 3.5, lineWidth = 0.75, cameraPosition = (1.2,1.,.5)
)</code></pre><p><img src="../../assets/images/tutorials/SecondOrderGradient.png" alt="Three points \$x,y,z\$ and the negative gradient of the second order absolute difference"/></p><p>If we now perform a gradient step, we obtain the three points</p><pre><code class="language-julia">xn, yn, zn = exp.(Ref(M), [x,y,z], [-ξx,-ξy,-ξz])</code></pre><pre><code class="language-none">3-element Array{SnPoint{Float64},1}:
 Sn([0.7602445970756302, 4.563951614149273e-18, 0.6496369390800624])  
 Sn([0.6474502912317516, 0.6474502912317516, 0.40201522454732996])    
 Sn([-4.5639516141492734e-18, 0.7602445970756302, 0.6496369390800624])</code></pre><p>as well we the new mid point</p><pre><code class="language-julia">cn = midPoint(M,xn,zn)
geoPts_yncn = geodesic(M,yn,cn,T)</code></pre><p>and obtain the new situation</p><pre><code class="language-julia">renderAsymptote(&quot;SecondOrderMin1.asy&quot;,asyExportS2Signals;
    render = asyResolution,
    points = [ [x,y,z], [c,c2,cn], [xn,yn,zn] ],
    curves = [ geoPts_yncn ] ,
    tVectors = [TVectorE.( [-ξx, -ξy, -ξz], [x, y, z] )],
    colors=Dict(:tvectors =&gt; [TolVibrantCyan],
        :points =&gt; [black, TolVibrantBlue, TolVibrantOrange],
        :curves =&gt; [TolVibrantTeal]
    ),
    dotSize = 3.5, lineWidth = 0.75, cameraPosition = (1.2,1.,.5)
)</code></pre><p><img src="../../assets/images/tutorials/SecondOrderMin1.png" alt="A gradient Step"/></p><p>One can see, that this step slightly “overshoots”, i.e. <span>$y$</span> is now even below <span>$c$</span>. and the cost function is still at</p><pre><code class="language-julia">costTV2(M, (xn, yn, zn) )</code></pre><pre><code class="language-none">0.46579428818288593</code></pre><p>But we can also search for the best step size using <a href="../../plans/#Manopt.ArmijoLinesearch"><code>ArmijoLinesearch</code></a> on the <a href="../../manifolds/combined/#Manopt.Power"><code>Power</code></a> manifold <span>$\mathcal N = \mathcal M^3 = (\mathbb S^2)^3$</span></p><pre><code class="language-julia">p = PowPoint([x,y,z])
N = Power(M,3)
s = ArmijoLinesearch(1.0,exp,0.999,0.96)(N, p,
    x -&gt; costTV2(M, Tuple(getValue(x))),
    PowTVector( [ gradTV2(M, (x,y,z))... ] ) # transform from tuple to PowTVector
)</code></pre><pre><code class="language-none">0.7348020742679654</code></pre><p>and for the new points</p><pre><code class="language-julia">xm, ym, zm = exp.(Ref(M), [x,y,z], s*[-ξx,-ξy,-ξz])
cm = midPoint(M,xm,zm)
geoPts_xmzm = geodesic(M,xm,zm,T)</code></pre><p>we obtain again with</p><pre><code class="language-julia">renderAsymptote(&quot;SecondOrderMin2.asy&quot;,asyExportS2Signals;
    render = asyResolution,
    points = [ [x,y,z], [c,c2,cm], [xm,ym,zm] ],
    curves = [ geoPts_xmzm ] ,
    tVectors = [TVectorE.( [-ξx, -ξy, -ξz], [x, y, z] )],
    colors=Dict(:tvectors =&gt; [TolVibrantCyan],
                :points =&gt; [black, TolVibrantBlue, TolVibrantOrange],
                :curves =&gt; [TolVibrantTeal]
                ),
    dotSize = 3.5, lineWidth = 0.75, cameraPosition = (1.2,1.,.5)
)</code></pre><p><img src="../../assets/images/tutorials/SecondOrderMin2.png" alt="A gradient Step"/></p><p>Here, the cost function yields</p><pre><code class="language-julia">costTV2( M, (xm, ym, zm) )</code></pre><pre><code class="language-none">0.0012555303253956782</code></pre><p>which is nearly zero, as one can also see, since the new center <span>$c$</span> and <span>$y$</span> are quite close.</p><h2><a class="nav-anchor" id="Literature-1" href="#Literature-1">Literature</a></h2><ul>
<li id="BačákBergmannSteidlWeinmann2016">[<a>Bačák, Bergmann, Steidl, Weinmann, 2016</a>]
  Bačák, M; Bergmann, R.; Steidl, G; Weinmann, A.: <emph>A second order nonsmooth
  variational model for restoring manifold-valued images.</emph>,
  SIAM Journal on Scientific Computations, Volume 38, Number 1, pp. A567–597,
  doi: <a href="https://doi.org/10.1137/15M101988X">10.1137/15M101988X</a></li>
</ul><footer><hr/><a class="previous" href="../MeanAndMedian/"><span class="direction">Previous</span><span class="title">Getting Started: Optimize!</span></a><a class="next" href="../JacobiFields/"><span class="direction">Next</span><span class="title">Jacobi Fields</span></a></footer></article></body></html>
